{"version":3,"sources":["compiler.js"],"names":[],"mappings":"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","file":"angular2/src/render/dom/compiler/compiler.js","sourcesContent":["import {Injectable} from 'angular2/src/di/annotations_impl';\n\nimport {PromiseWrapper, Promise} from 'angular2/src/facade/async';\nimport {BaseException, isPresent} from 'angular2/src/facade/lang';\nimport {DOM} from 'angular2/src/dom/dom_adapter';\n\nimport {ViewDefinition, ProtoViewDto, DirectiveMetadata, RenderCompiler, RenderProtoViewRef} from '../../api';\nimport {CompilePipeline} from './compile_pipeline';\nimport {TemplateLoader} from 'angular2/src/render/dom/compiler/template_loader';\nimport {CompileStepFactory, DefaultStepFactory} from './compile_step_factory';\nimport {Parser} from 'angular2/change_detection';\nimport {ShadowDomStrategy} from '../shadow_dom/shadow_dom_strategy';\n\n/**\n * The compiler loads and translates the html templates of components into\n * nested ProtoViews. To decompose its functionality it uses\n * the CompilePipeline and the CompileSteps.\n */\nexport class DomCompiler extends RenderCompiler {\n  _templateLoader: TemplateLoader;\n  _stepFactory: CompileStepFactory;\n\n  constructor(stepFactory: CompileStepFactory, templateLoader: TemplateLoader) {\n    super();\n    this._templateLoader = templateLoader;\n    this._stepFactory = stepFactory;\n  }\n\n  compile(template: ViewDefinition):Promise<ProtoViewDto> {\n    var tplPromise = this._templateLoader.load(template);\n    return PromiseWrapper.then(tplPromise,\n      (el) => this._compileTemplate(template, el),\n      (_) => { throw new BaseException(`Failed to load the template \"${template.componentId}\"`); }\n    );\n  }\n\n  compileHost(directiveMetadata: DirectiveMetadata):Promise<ProtoViewDto> {\n    var hostViewDef = new ViewDefinition({\n      componentId: directiveMetadata.id,\n      absUrl: null,\n      template: null,\n      directives: [directiveMetadata]\n    });\n    var element = DOM.createElement(directiveMetadata.selector);\n    return this._compileTemplate(hostViewDef, element);\n  }\n\n  _compileTemplate(viewDef: ViewDefinition, tplElement):Promise<ProtoViewDto> {\n    var subTaskPromises = [];\n    var pipeline = new CompilePipeline(this._stepFactory.createSteps(viewDef, subTaskPromises));\n    var compileElements = pipeline.process(tplElement, viewDef.componentId);\n\n    var protoView = compileElements[0].inheritedProtoView.build();\n\n    if (subTaskPromises.length > 0) {\n      return PromiseWrapper.all(subTaskPromises).then((_) => protoView);\n    } else {\n      return PromiseWrapper.resolve(protoView);\n    }\n  }\n}\n\n@Injectable()\nexport class DefaultDomCompiler extends DomCompiler {\n  constructor(parser:Parser, shadowDomStrategy:ShadowDomStrategy, templateLoader: TemplateLoader) {\n    super(new DefaultStepFactory(parser, shadowDomStrategy), templateLoader);\n  }\n}\n"]}