{"version":3,"sources":["route_registry.js"],"names":[],"mappings":"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","file":"angular2/src/router/route_registry.js","sourcesContent":["import {RouteRecognizer} from './route_recognizer';\nimport {Instruction, noopInstruction} from './instruction';\nimport {List, ListWrapper, Map, MapWrapper, StringMap, StringMapWrapper} from 'angular2/src/facade/collection';\nimport {isPresent, isBlank, isType, StringWrapper, BaseException} from 'angular2/src/facade/lang';\nimport {RouteConfig} from './route_config_impl';\nimport {reflector} from 'angular2/src/reflection/reflection';\n\nexport class RouteRegistry {\n  _rules:Map<any, RouteRecognizer>;\n\n  constructor() {\n    this._rules = MapWrapper.create();\n  }\n\n  config(parentComponent, config) {\n    if (!StringMapWrapper.contains(config, 'path')) {\n      throw new BaseException('Route config does not contain \"path\"');\n    }\n\n    if (!StringMapWrapper.contains(config, 'component') &&\n        !StringMapWrapper.contains(config, 'components') &&\n        !StringMapWrapper.contains(config, 'redirectTo')) {\n      throw new BaseException('Route config does not contain \"component,\" \"components,\" or \"redirectTo\"');\n    }\n\n    var recognizer:RouteRecognizer;\n    if (MapWrapper.contains(this._rules, parentComponent)) {\n      recognizer = MapWrapper.get(this._rules, parentComponent);\n    } else {\n      recognizer = new RouteRecognizer();\n      MapWrapper.set(this._rules, parentComponent, recognizer);\n    }\n\n    config = normalizeConfig(config);\n\n    if (StringMapWrapper.contains(config, 'redirectTo')) {\n      recognizer.addRedirect(StringMapWrapper.get(config, 'path'), StringMapWrapper.get(config, 'redirectTo'));\n      return;\n    }\n\n    var components = StringMapWrapper.get(config, 'components');\n    StringMapWrapper.forEach(components, (component, _) => {\n      this.configFromComponent(component);\n    });\n\n    recognizer.addConfig(config['path'], config, config['as']);\n  }\n\n  configFromComponent(component) {\n    if (!isType(component)) {\n      return;\n    }\n\n    // Don't read the annotations from a type more than once â€“\n    // this prevents an infinite loop if a component routes recursively.\n    if (MapWrapper.contains(this._rules, component)) {\n      return;\n    }\n    var annotations = reflector.annotations(component);\n    if (isPresent(annotations)) {\n      for (var i=0; i<annotations.length; i++) {\n        var annotation = annotations[i];\n\n        if (annotation instanceof RouteConfig) {\n          ListWrapper.forEach(annotation.configs, (config) => {\n            this.config(component, config);\n          })\n        }\n      }\n    }\n  }\n\n\n  recognize(url:string, parentComponent) {\n    var componentRecognizer = MapWrapper.get(this._rules, parentComponent);\n    if (isBlank(componentRecognizer)) {\n      return null;\n    }\n\n    var solutions = componentRecognizer.recognize(url);\n\n    for(var i = 0; i < solutions.length; i++) {\n      var candidate = solutions[i];\n      if (candidate['unmatchedUrl'].length == 0) {\n        return handlerToLeafInstructions(candidate, parentComponent);\n      }\n\n      var children = StringMapWrapper.create(),\n          allMapped = true;\n\n      StringMapWrapper.forEach(candidate['handler']['components'], (component, name) => {\n        if (!allMapped) {\n          return;\n        }\n        var childInstruction = this.recognize(candidate['unmatchedUrl'], component);\n        if (isPresent(childInstruction)) {\n          childInstruction.params = candidate['params'];\n          children[name] = childInstruction;\n        } else {\n          allMapped = false;\n        }\n      });\n\n      if (allMapped) {\n        return new Instruction({\n          component: parentComponent,\n          children: children,\n          matchedUrl: candidate['matchedUrl']\n        });\n      }\n    }\n\n    return null;\n  }\n\n  generate(name:string, params:any, hostComponent) {\n    //TODO: implement for hierarchical routes\n    var componentRecognizer = MapWrapper.get(this._rules, hostComponent);\n    if (isPresent(componentRecognizer)) {\n      return componentRecognizer.generate(name, params);\n    }\n  }\n}\n\nfunction handlerToLeafInstructions(context, parentComponent) {\n  var children = StringMapWrapper.create();\n  StringMapWrapper.forEach(context['handler']['components'], (component, outletName) => {\n    children[outletName] = new Instruction({\n      component: component,\n      params: context['params']\n    });\n  });\n  return new Instruction({\n    component: parentComponent,\n    children: children,\n    matchedUrl: context['matchedUrl']\n  });\n}\n\n// given:\n// { component: Foo }\n// mutates the config to:\n// { components: { default: Foo } }\nfunction normalizeConfig(config:StringMap) {\n  if (StringMapWrapper.contains(config, 'component')) {\n    var component = StringMapWrapper.get(config, 'component');\n    var components = StringMapWrapper.create();\n    StringMapWrapper.set(components, 'default', component);\n\n    var newConfig = StringMapWrapper.create();\n    StringMapWrapper.set(newConfig, 'components', components);\n\n    StringMapWrapper.forEach(config, (value, key) => {\n      if (!StringWrapper.equals(key, 'component') && !StringWrapper.equals(key, 'components')) {\n        StringMapWrapper.set(newConfig, key, value);\n      }\n    });\n\n    return newConfig;\n  }\n  return config;\n}\n"]}