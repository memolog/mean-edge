{"version":3,"sources":["instruction.js"],"names":[],"mappings":"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","file":"angular2/src/router/instruction.js","sourcesContent":["import {Map, MapWrapper, StringMap, StringMapWrapper,  List, ListWrapper} from 'angular2/src/facade/collection';\nimport {Promise, PromiseWrapper} from 'angular2/src/facade/async';\nimport {isPresent} from 'angular2/src/facade/lang';\n\nexport class RouteParams {\n  params:Map<string, string>;\n  constructor(params:StringMap) {\n    this.params = params;\n  }\n\n  get(param:string) {\n    return StringMapWrapper.get(this.params, param);\n  }\n}\n\nexport class Instruction {\n  component:any;\n  _children:Map<string, Instruction>;\n  router:any;\n  matchedUrl:string;\n  params:Map<string, string>;\n  reuse:boolean;\n\n  constructor({params, component, children, matchedUrl}:{params:StringMap, component:any, children:Map, matchedUrl:string} = {}) {\n    this.reuse = false;\n    this.matchedUrl = matchedUrl;\n    if (isPresent(children)) {\n      this._children = children;\n      var childUrl;\n      StringMapWrapper.forEach(this._children, (child, _) => {\n        childUrl = child.matchedUrl;\n      });\n      if (isPresent(childUrl)) {\n        this.matchedUrl += childUrl;\n      }\n    } else {\n      this._children = StringMapWrapper.create();\n    }\n    this.component = component;\n    this.params = params;\n  }\n\n  getChildInstruction(outletName:string) {\n    return StringMapWrapper.get(this._children, outletName);\n  }\n\n  forEachChild(fn:Function) {\n    StringMapWrapper.forEach(this._children, fn);\n  }\n\n  mapChildrenAsync(fn):Promise {\n    return mapObjAsync(this._children, fn);\n  }\n\n  /**\n   * Does a synchronous, breadth-first traversal of the graph of instructions.\n   * Takes a function with signature:\n   * (parent:Instruction, child:Instruction) => {}\n   */\n  traverseSync(fn:Function) {\n    this.forEachChild((childInstruction, _) => fn(this, childInstruction));\n    this.forEachChild((childInstruction, _) => childInstruction.traverseSync(fn));\n  }\n\n  /**\n   * Does an asynchronous, breadth-first traversal of the graph of instructions.\n   * Takes a function with signature:\n   * (child:Instruction, parentOutletName:string) => {}\n   */\n  traverseAsync(fn:Function) {\n    return this.mapChildrenAsync(fn)\n        .then((_) => this.mapChildrenAsync((childInstruction, _) => childInstruction.traverseAsync(fn)));\n  }\n\n\n  /**\n   * Takes a currently active instruction and sets a reuse flag on this instruction\n   */\n  reuseComponentsFrom(oldInstruction:Instruction) {\n    this.forEachChild((childInstruction, outletName) => {\n      var oldInstructionChild = oldInstruction.getChildInstruction(outletName);\n      if (shouldReuseComponent(childInstruction, oldInstructionChild)) {\n        childInstruction.reuse = true;\n      }\n    });\n  }\n}\n\nfunction shouldReuseComponent(instr1:Instruction, instr2:Instruction) {\n  return instr1.component == instr2.component &&\n    StringMapWrapper.equals(instr1.params, instr2.params);\n}\n\nfunction mapObjAsync(obj:StringMap, fn) {\n  return PromiseWrapper.all(mapObj(obj, fn));\n}\n\nfunction mapObj(obj:StringMap, fn):List {\n  var result = ListWrapper.create();\n  StringMapWrapper.forEach(obj, (value, key) => ListWrapper.push(result, fn(value, key)));\n  return result;\n}\n\nexport var noopInstruction = new Instruction();\n"]}